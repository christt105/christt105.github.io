{{ define "body-class" }} article-page {{end}} {{ define "main" }}
<article class="main-article">
    {{ partial "article/components/header" . }}

    
    <section class="article-content">
        <h2>Experience</h2>
        {{ $experiences := where .Site.RegularPages "Section" "experience" }}
        {{ $items := slice }}

        {{ range $p := $experiences }}
        {{ $hasOpenJob := false }}
        {{ $latestStart := time "0001-01-01" }}

        {{ range $p.Params.jobs }}
        {{ if not .end }}
        {{ $hasOpenJob = true }}
        {{ end }}
        {{ $startTime := time .start }}
        {{ if gt $startTime $latestStart }}
        {{ $latestStart = $startTime }}
        {{ end }}
        {{ end }}

        {{ $items = $items | append (dict "page" $p "latestStart" $latestStart "hasOpenJob" $hasOpenJob) }}
        {{ end }}

        {{ $sorted := sort (sort $items "latestStart" "desc") "hasOpenJob" "desc" }}

        {{ range $item := $sorted }}
        {{ $exp := $item.page }}
{{ $totalSeconds := 0 }}

{{ range $job := $exp.Params.jobs }}
  {{ $start := time $job.start }}
  {{ $end := now }}
    {{ if $job.end }}
    {{ $end = time $job.end }}
    {{ end }}
  {{ $totalSeconds = add $totalSeconds (sub $end.Unix $start.Unix) }}
{{ end }}

{{ $totalYears := div $totalSeconds 31556926 }}
{{ $totalMonths := mod (div $totalSeconds 2629743) 12 }}

{{ $totalDurationParts := slice }}
{{ if gt $totalYears 0 }}
  {{ $totalDurationParts = $totalDurationParts | append (i18n "duration.year" (dict "Count" $totalYears)) }}
{{ end }}
{{ if gt $totalMonths 0 }}
  {{ $totalDurationParts = $totalDurationParts | append (i18n "duration.month" (dict "Count" $totalMonths)) }}
{{ end }}

{{ $totalDuration := delimit $totalDurationParts " " }}

        <div>
            <h4 style="display: flex; align-items: center; gap: 0.75em;">
                {{- $image := partialCached "helper/image" (dict "Context" $exp "Type" "experience") $exp.RelPermalink
                "experience" -}}
                {{ if $image.exists }}
                {{ if $image.resource }}
                <img src="{{ $image.resource.RelPermalink }}" alt="Logo {{ $exp.Title }}"
                    style="height: 40px; width: 40px;" />
                {{ else }}
                <img src="{{ $image.permalink }}" alt="Logo {{ $exp.Title }}" style="height: 40px; width: 40px;" />
                {{ end }}
                {{ end }}
                {{ $exp.Title }}
            </h4>
                {{ if $totalDuration }}
                <p class="article-subtitle">
                    {{ if gt (len $exp.Params.jobs) 1 }}
                    {{ i18n $exp.Params.contractType }}
                    {{ else }}
                    {{ $job := index $exp.Params.jobs 0 }}
                    {{ time $job.start | time.Format "January 2006" }} -
                    {{ if $job.end }}
                    {{ time $job.end | time.Format "January 2006" }}
                    {{ else }}
                    {{ i18n "present" }}
                    {{ end }}
                    {{ end}} · {{ $totalDuration }}
                </p>
                <p class="article-subtitle">
                    {{ if $exp.Params.location }}
                    <span class="location">{{ $exp.Params.location }}</span>
                    {{ end }} · 
                    {{ if $exp.Params.locationType }}
                    <span class="locationType">{{ i18n $exp.Params.locationType }}</span>
                    {{ end }}
                </p>
                {{ end }}
        </div>
        {{ range $job := $exp.Params.jobs }}

        {{ $start := time $job.start }}
        {{ $end := now }}
        {{ if $job.end }}
        {{ $end = time $job.end }}
        {{ end }}


{{ $years := div (sub $end.Unix $start.Unix) 31556926 }}
{{ $months := mod (div (sub $end.Unix $start.Unix) 2629743) 12 }}

{{ $duration := slice }}

{{ if gt $years 0 }}
  {{ $duration = $duration | append (i18n "duration.year" (dict "Count" $years)) }}
{{ end }}

{{ if gt $months 0 }}
  {{ $duration = $duration | append (i18n "duration.month" (dict "Count" $months)) }}
{{ end }}

        <div style="margin: 1em 0 2em 0; padding-left: 1em; border-left: 2px solid var(--accent-color);">
            <p class="article-title" style="margin: 0; font-weight: bold;">{{ $job.title }}</p>

            {{ if gt (len $exp.Params.jobs) 1 }}
            <p class="article-subtitle">
                {{ time $job.start | time.Format "January 2006" }} -
                {{ if $job.end }}
                {{ time $job.end | time.Format "January 2006" }}
                {{ else }}
                {{ i18n "present" }}
                {{ end }} · {{ delimit $duration " " }}
            </p>
            {{ end }}

            <p style="margin: 0.5em 0;">{{ $job.description }}</p>

            {{/* {{ with $job.skills }}
            <p style="margin: 0.5em 0; font-size: 0.9em; color: #555;">
                <strong>Skills:</strong> {{ delimit . ", " }}
            </p>
            {{ end }} */}}
        </div>
        {{ end }}
        {{ end }}

        <hr>

         <h2>Education</h2>
         {{ with site.GetPage "education" }}
           {{ with .Params.entries }}
             {{ range sort . "start" "desc" }}
               <div class="education-entry" style="margin: 1em 0 2em 0; padding-left: 1em; border-left: 2px solid var(--accent-color);">
                 <p style="margin: 0; font-weight: bold;">
                   {{ .title }}
                 </p>
                 <p class="article-subtitle">
                   {{ time .start | time.Format "2006" }} — {{ time .end | time.Format "2006" }}
                 </p>
                 {{ if .institution }}
                   <p style="margin: 0.3em 0;">
                     {{ .institution }}
                   </p>
                 {{ end }}
               </div>
             {{ end }}
           {{ end }}
         {{ end }}


    </section>

</article>

{{ partialCached "footer/footer" . }}
{{ end }}